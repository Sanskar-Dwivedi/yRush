<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>yRush ¬∑ Xerox / Print Upload</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{--bg:#0b0d10;--panel:#12151a;--text:#e5e7eb;--muted:#9aa4b5;--border:#202734;--accent:#60e7d7}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Arial}
    .wrap{max-width:860px;margin:32px auto;padding:20px;background:var(--panel);border:1px solid var(--border);border-radius:16px}
    h1{margin:0 0 6px}
    .muted{color:var(--muted)}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    label{font-size:13px;color:var(--muted)}
    input,select,textarea{width:100%;padding:10px;border-radius:10px;border:1px solid var(--border);background:#0e1319;color:var(--text)}
    textarea{min-height:70px;resize:vertical}
    .hr{height:1px;background:var(--border);margin:16px 0}
    .btn{display:inline-block;padding:12px 16px;border-radius:10px;border:1px solid var(--border);cursor:pointer;text-decoration:none;color:var(--text)}
    .btn.primary{background:var(--accent);color:#0b0d10;border-color:#1f3b3b;font-weight:700}
    .btn.ghost{background:transparent}
    .bar{display:flex;gap:10px;flex-wrap:wrap;margin-top:16px}
    .filebox{padding:14px;border:1px dashed var(--border);border-radius:12px;background:#0e1319}
    .callout{padding:12px;border-radius:10px;border:1px solid var(--border);background:#0e1319;margin-top:12px}
    .success{border-color:#065f46;background:rgba(16,185,129,.12)}
    .warn{border-color:#7f1d1d;background:rgba(239,68,68,.12)}
    .topbar{display:flex;gap:10px;margin-bottom:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <a class="btn ghost" href="list.html">‚Üê Back</a>
      <a class="btn ghost" href="checkOut.html">üõí Checkout</a>
      <a class="btn ghost" href="printInbox.html">üñ®Ô∏è Shopkeeper Inbox</a>
    </div>

    <h1>Xerox / Print Upload</h1>
    <p class="muted">Upload images or PDFs and set print options. This demo sends jobs to the shopkeeper‚Äôs inbox in this browser.</p>

    <div class="grid" style="margin-top:10px">
      <div>
        <label>Your name</label>
        <input id="custName" placeholder="e.g. Sanskar" />
      </div>
      <div>
        <label>Phone</label>
        <input id="custPhone" placeholder="10-digit phone" inputmode="numeric" />
      </div>
      <div>
        <label>Copies</label>
        <input id="copies" type="number" min="1" value="1" />
      </div>
      <div>
        <label>Color Mode</label>
        <select id="color">
          <option value="BW">Black & White</option>
          <option value="COLOR">Color</option>
        </select>
      </div>
      <div>
        <label>Pages (optional)</label>
        <input id="pages" placeholder="e.g. 1-3,5,8-10" />
      </div>
      <div>
        <label>Sides</label>
        <select id="sides">
          <option value="single">Single-sided</option>
          <option value="duplex">Double-sided (duplex)</option>
        </select>
      </div>
      <div>
        <label>Paper Size</label>
        <select id="paper">
          <option value="A4" selected>A4</option>
          <option value="A3">A3</option>
          <option value="Letter">Letter</option>
        </select>
      </div>
      <div>
        <label>Notes</label>
        <input id="notes" placeholder="e.g. Staple left, print 2-slides per page" />
      </div>
    </div>

    <div class="hr"></div>

    <div class="filebox">
      <label><b>Files</b> (images/PDFs)</label>
      <input id="files" type="file" accept="image/*,application/pdf" multiple />
      <p class="muted" style="margin:8px 0 0">Tip: For demo, keep each file under ~2‚Äì3 MB to save in-browser.</p>
    </div>

    <div id="status" class="callout" style="display:none"></div>

    <div class="bar">
      <button id="sendBtn" class="btn primary">üì® Send to Shopkeeper</button>
      <button id="clearBtn" class="btn ghost">Clear</button>
    </div>
  </div>

  <script>
    // keys
    const PRINT_KEY = 'yrush_print_jobs';

    // helpers
    const load = k => { try{return JSON.parse(localStorage.getItem(k))||[];}catch(e){return [];} };
    const save = (k,v) => localStorage.setItem(k, JSON.stringify(v));
    const byId = id => document.getElementById(id);

    const statusBox = byId('status');

    function show(msg, ok=true){
      statusBox.className = 'callout ' + (ok ? 'success' : 'warn');
      statusBox.style.display = 'block';
      statusBox.innerHTML = msg;
    }

    async function fileToDataURL(file){
      return new Promise((resolve,reject)=>{
        const r = new FileReader();
        r.onerror = () => reject('Failed reading file');
        r.onload = () => resolve(r.result);     // data:... base64
        r.readAsDataURL(file);
      });
    }

    function token(){
      return 'P' + Math.random().toString(36).slice(2,8).toUpperCase();
    }

    // Broadcast to shopkeeper tab
    function broadcastNewJob(job){
      try{
        if(typeof BroadcastChannel !== 'undefined'){
          const ch = new BroadcastChannel('yRush_print');
          ch.postMessage({type:'PRINT_JOB_NEW', jobId:job.id});
          ch.close();
        }
      }catch(e){}
    }

    // send
    byId('sendBtn').onclick = async () => {
      statusBox.style.display = 'none';

      const name  = (byId('custName').value||'Customer').trim();
      const phone = (byId('custPhone').value||'').trim();
      const copies = Math.max(1, parseInt(byId('copies').value||'1',10));
      const color  = byId('color').value;
      const pages  = (byId('pages').value||'').trim();
      const sides  = byId('sides').value;
      const paper  = byId('paper').value;
      const notes  = (byId('notes').value||'').trim();

      const fInput = byId('files');
      if(!fInput.files || !fInput.files.length){
        show('Please choose at least one file.', false); return;
      }

      // Convert files -> DataURLs (demo)
      const files = [];
      for(const f of Array.from(fInput.files)){
        const dataUrl = await fileToDataURL(f); // base64
        files.push({
          name: f.name,
          type: f.type,
          size: f.size,
          dataUrl
        });
      }

      // Build job
      const job = {
        id: token(),
        createdAt: new Date().toISOString(),
        customer: { name, phone },
        options: { copies, color, pages, sides, paper, notes },
        files,
        status: 'Queued'
      };

      // Save
      const list = load(PRINT_KEY);
      list.push(job);
      save(PRINT_KEY, list);

      // Notify
      broadcastNewJob(job);

      // Done UI
      show(`‚úÖ Sent to shopkeeper. Your Print ID: <b>${job.id}</b>`);
      fInput.value = '';
      // Keep user info/options for convenience; clear if you want:
      // ['custName','custPhone','copies','color','pages','sides','paper','notes'].forEach(id=>byId(id).value='');
    };

    byId('clearBtn').onclick = () => {
      ['custName','custPhone','pages','notes'].forEach(id => byId(id).value='');
      byId('copies').value = 1;
      byId('color').value = 'BW';
      byId('sides').value = 'single';
      byId('paper').value = 'A4';
      byId('files').value = '';
      statusBox.style.display = 'none';
    };
  </script>
</body>
</html>
